package go_smpp

import (
	"testing"
	"fmt"
)

func TestCreateFromRawBytes(t *testing.T) {
	data := []byte{0x00,0x00,0x00,0x2F,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x53,0x4D,0x50,0x50,0x33,0x54,0x45,0x53,0x54,0x00,
		0x73,0x65,0x63,0x72,0x65,0x74,0x30,0x38,0x00,0x53,0x55,0x42,0x4D,0x49,0x54,0x31,0x00,0x00,0x01,0x01,0x00}


	pdu := Pdu(data)
	if pdu.command_length != 47 {
		t.Error("Expected pdu.command_length 47", pdu.command_length)
	}

	if pdu.complete == false {
		t.Error("Expected pdu.complete = true got", pdu.complete)
	}

	if pdu.command_id == PDU_COMMAND_BIND_RX {
		t.Error("Expected bind command", pdu.command_id)
	}

	system_id := "SMPP3TEST"
	if string(pdu.system_id) != system_id {
		t.Error("Expected system_id xxx got", pdu.system_id)
	}

	password := "secret08"
	if string(pdu.password) != password {
		t.Error(fmt.Sprintf("Expected system_id %s got",password), string(pdu.password))
	}

	address_range := ""
	if string(pdu.address_range) != address_range {
		t.Error(fmt.Sprintf("Expected system_id %s got",address_range), string(pdu.address_range))
	}


}


func TestIncomplete(t *testing.T) {
	data := []byte{0x00,0x00,0x00,0x2F,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x53,0x4D,0x50,0x50,0x33,0x54,0x45,0x53,0x54,0x00,
		0x73,0x65,0x63,0x72,0x65,0x74,0x30,0x38,0x00,0x53,0x55,0x42,0x4D,0x49,0x54,0x31,0x00,0x00,0x01}

	pdu := Pdu(data)

	if pdu.complete == true {
		t.Error("Expected incomplete PDU got", pdu.complete)
	}

	if pdu.command_id == PDU_COMMAND_BIND_RX {
		t.Error("Expected bind command", pdu.command_id)
	}

}